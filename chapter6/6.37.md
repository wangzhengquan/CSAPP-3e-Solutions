6.37

```c
!INCLUDE "./code/6.37.c"
```

Function 	N=64 		N=60
	sumA	 1/4        1/4
	sumB   100%       1/4
	sumC   1/2        1/4

## 分析
C = 4096, B = 16, E = 1, S = 256


### N = 64
#### A
row-major顺序加载，命中率取决于block长度，不管N值为多少,不命中率都为1/4

#### B

内循环每次遍历步长以数组元素为单位setp_ele=64，每个set(block)容量以元素为单位Be=16/4=4 ，步长以set为单位step_sets=setp_ele/Be = 16。内循环遍历到行S/setp_sets=16时刚好达到cache的大小限度，再次遍历会覆盖前面已经加载的数据, N/16==4完全整除也就是完全覆盖,所以不命中率时100%。 

例如,针对第1列，行1对应set[0]，行2对应set[16]，行16对应set[240]，行17对应set[0],可以看出后面加载的数据会覆盖前面的已经加载的数据,遍历第2，3，4列时不可以命中.


                            block offset
	
                            0        1*4       2*4       3*4       
          set index    0    +---------+---------+---------+---------+
                            |         |         |         |         |
                       16   +---------+---------+---------+---------+
                            |         |         |         |         |
                       32   +---------+---------+---------+---------+
                            |         |         |         |         |
                       48   +---------+---------+---------+---------+
                            |    .    |    .    |    .    |    .    |
                            |    .    |    .    |    .    |    .    |
                            |    .    |    .    |    .    |    .    |
                            |    .    |    .    |    .    |    .    |
                            |    .    |    .    |    .    |    .    |
                      240   +---------+---------+---------+---------+
                            |         |         |         |         |
                            +---------+---------+---------+---------+                       
                              
                            cache图

#### C
情况同B类似，但是每次取两列可以有一个命中，所以不命中率为1/2
 

### N = 60

#### A
不管N值为多少 不命中率都为1/4

#### B
 
数据大小不是cache大小的整数倍，所以后面加载数据的不会会覆盖前面加载的。

一个数据行60个元素， 每个block容纳4个元素，每个数据行对应set数（60/4 = 15）,sets数256除以15等于17余1，不能整除，所以当达到cache大小限度继续遍历时不会覆盖前面已经加载的。又每次加载4列数据，总共60列，60能被4完全整除，所以不命中率为1/4。

例如,针对第1列，行1对应set[0]，行2对应set[15]，行17对应set[255]，行18对应set[14],可以看出后面加载的数据不会覆盖前面的已经加载的数据,遍历第2，3，4列时可以命中.
 
 
                            block offset
	
                            0        1*4       2*4       3*4       
          set index    0    +---------+---------+---------+---------+
                            |         |         |         |         |
                       15   +---------+---------+---------+---------+
                            |         |         |         |         |
                       30   +---------+---------+---------+---------+
                            |         |         |         |         |
                       45   +---------+---------+---------+---------+
                            |    .    |    .    |    .    |    .    |
                            |    .    |    .    |    .    |    .    |
                            |    .    |    .    |    .    |    .    |
                            |    .    |    .    |    .    |    .    |
                            |    .    |    .    |    .    |    .    |
                      240   +---------+---------+---------+---------+
                            |         |         |         |         |
                      255   +---------+---------+---------+---------+                       
                              
                            cache图



#### C
同B类似，不命中率为1/4



